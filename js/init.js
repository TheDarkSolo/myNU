dojo._hasResource["com.ibm.themes.PageBuilder2.init"]||(dojo._hasResource["com.ibm.themes.PageBuilder2.init"]=!0,dojo.provide("com.ibm.themes.PageBuilder2.init"),com.ibm.themes.PageBuilder2.init=function(){var e=com.ibm.mashups.enabler.logging.Logger.getLogger("com.ibm.themes.PageBuilder2.init"),o="onload";e.entering(o),e.trace(o,"Registering context menus");var t="com.ibm.themes.PageBuilder2.menuDefinitions",i=dojo.getObject("ibmCfg.themeConfig.contextMenus",!0),a=new com.ibm.pb.contextMenu.JsonContextMenuLoader({url:dojo.moduleUrl(t,"bannerLinks.json"),data:i.bannerLinks}),n=new com.ibm.pb.contextMenu.JsonContextMenuLoader({url:dojo.moduleUrl(t,"userActions.json"),data:i.userActions}),r=new com.ibm.pb.contextMenu.JsonContextMenuLoader({url:dojo.moduleUrl(t,"pageActions.json"),data:i.pageActions}),s=new com.ibm.pb.contextMenu.JsonContextMenuLoader({url:dojo.moduleUrl(t,"widgetActions.json"),data:i.widgetActions}),m=com.ibm.mashups.builder.model.Factory.getContextMenuModel();m.registerContextMenu("bannerLinks",a),m.registerContextMenu("userActions",n),m.registerContextMenu("pageActions",r),m.registerContextMenu("widgetActions",s),com.ibm.mashups.iwidget.services.ServiceManager.getService("eventService").subscribeEvent("com.ibm.mashups.builder.changePageMode",r,r.onChange),e.trace(o,"Checking a11y");var c=document.getElementsByTagName("body")[0];dojo.hasClass(c,"dijit_a11y")&&dojo.addClass(c,"lotusImagesOff");var l=dojo.i18n.getLocalization("com.ibm.bundles","Theme"),d={clear:l.statusbar_clear,print:l.statusbar_print,showDetails:l.statusbar_show_details,hideDetails:l.statusbar_hide_details,warning:l.statusbar_warning,error:l.statusbar_error,info:l.statusbar_info,statusError:l.statusbar_status_error,messagesAvailable:l.statusbar_messages_available,itemsAvailable:l.statusbar_items_available};dojo._loadedModules["com.ibm.portal.nls.v3theme"]={ROOT:d,"${wp.preferredLocale}":d},new com.ibm.widgets.StatusBar({uid:"ibmStatusBox",locale:ibmCfg.portalConfig.locale,errorGifPath:ibmCfg.themeConfig.themeRootURI+"/images/statusBar/error.gif",warningGifPath:ibmCfg.themeConfig.themeRootURI+"/images/statusBar/warning.gif",infoGifPath:ibmCfg.themeConfig.themeRootURI+"/images/statusBar/info.gif",multipleMessagesGifPath:ibmCfg.themeConfig.themeRootURI+"/images/statusBar/info.gif"},"ibmStatusBarContainer").startup(),e.trace(o,"Parsing search widget"),dojo.parser.parse("themeSearchBoxContainer"),e.trace(o,"Adding live text config entries for decorations and semantic tagging");var u="/com/ibm/mashups/livetext/configentryadded",b=new com.ibm.mashups.livetext.ConfigEntry("*.component-control",!0,"com.ibm.pb.decorations",ibmConfig["com.ibm.mashups.contextroot.builder"]+"/js/com/ibm/pb/decorations","com.ibm.pb.decorations.DecorationManager",!0),g=new com.ibm.mashups.livetext.ConfigEntry(".com\\.ibm\\.portal\\.action",!1,"portallof","/wps_semanticTag/javascript","portallof.vcard",!1,"com.ibm.portal.action"),p=new com.ibm.mashups.livetext.ConfigEntry(".vcard",!1,"portallof","/wps_semanticTag/javascript","portallof.vcard",!1,"hcard"),h=new com.ibm.mashups.livetext.ConfigEntry(".c2a\\:source,.c2a\\:target",!1,"portallof","/wps_semanticTag/javascript","portallof.vcard",!1,"c2a");dojo.publish(u,[b]),dojo.publish(u,[g]),dojo.publish(u,[p]),dojo.publish(u,[h]),dojo.subscribe("/portal/status/theme",dojo.global,(function(e,o,t){var i=new com.ibm.widgets.StatusMessage(e,o,t);dojo.publish("/portal/status",[{message:i,uid:"ibmStatusBox"}])})),dojo.isIE&&dojo.addOnWindowUnload((function(){dijit.registry.forEach((function(e){e._destroyed||(e.destroyRecursive?e.destroyRecursive():e.destroy&&e.destroy())}))})),ibmCfg.themeConfig.editModeJSURL||com.ibm.themes.PageBuilder2.initEditMode(),e.exiting(o)},com.ibm.themes.PageBuilder2.initEditMode=function(){try{dojo.query("link[rel~=edit_mode]").forEach((function(e){dojo.attr(e,"rel","stylesheet")}))}catch(e){}var e=com.ibm.mashups.builder.model.Factory.getContextMenuModel(),o=new com.ibm.pb.decorations.LayoutDirectionalMoveControls;e.addContribution("widgetActions",o);var t=com.ibm.mashups.iwidget.services.ServiceManager.getService("eventService");dojo.forEach(["com.ibm.mashups.builder.hideWidget","com.ibm.mashups.builder.displayWidget"],(function(e){t.subscribeEvent(e,o,o.onChange)}),this),dojo.require("com.ibm.utilities"),dojo.require("com.ibm.pb.contextMenu.JsonContextMenuLoader"),dojo.require("com.ibm.pb.decorations.LayoutDirectionalMoveControls"),dojo.require("com.ibm.pb.customize.enabler.TabbedController"),dojo.require("com.ibm.pb.customize.enabler.AddContentController"),dojo.require("com.ibm.pb.customize.enabler.ChangeStyleController"),dojo.require("com.ibm.pb.customize.enabler.ChangeLayoutController"),dojo.require("com.ibm.customize.AddContentPaletteContainer"),dojo.require("com.ibm.customize.ChangeStylePaletteContainer"),dojo.require("com.ibm.customize.ChangeLayoutPaletteContainer");var i=com.ibm.customize,a=com.ibm.pb.customize.enabler;dojo.extend(i.AddContentPaletteContainer,a.AddContentController),dojo.extend(i.ChangeStylePaletteContainer,a.ChangeStyleController),dojo.extend(i.ChangeLayoutPaletteContainer,a.ChangeLayoutController)},livetextService=com.ibm.mashups.services.ServiceManager.getService(com.ibm.mashups.livetext.ServiceModel.SERVICE_NAME),TagService=SemTagSvc=livetextService,function(){var e=livetextService.onTagContentChanged,o=livetextService.onTagChanged;livetextService.onTagChanged=function(){var e=com.ibm.mashups.enabler.io.XHRMultipartFactory.create();e.startTransaction(),o.apply(this,arguments),e.endTransactionDeferred(!0).start()},livetextService.onTagContentChanged=function(){var o=com.ibm.mashups.enabler.io.XHRMultipartFactory.create();o.startTransaction(),e.apply(this,arguments),o.endTransactionDeferred(!0).start()}}()),ibmPortalConfig.resolver=com.ibm.data.Resolver.getStore({url:ibmPortalConfig.contentHandlerURI,namespaces:{ext:"http://www.ibm.com/xmlns/prod/websphere/portal/v6.0.1/portal-model",creationcontext:"http://www.ibm.com/xmlns/prod/websphere/portal/v6.1.0/portal-creation-context",base:"http://www.ibm.com/xmlns/prod/websphere/portal/v6.0/ibm-portal-composite-base",model:"http://www.ibm.com/xmlns/prod/websphere/portal/v6.0.1/portal-model-elements"},tunnel:ibmConfig["tunnel.mode"],isAuthenticated:!ibmConfig.anonymousUser}),dojo.addOnLoad((function(){var e=com.ibm.mashups.builder.model.Factory.getContextMenuModel(),o=new com.ibm.cp.TRContextMenuLoader(!0);e.addContribution("pageActions",o,60);var t=new com.ibm.cp.TRContextMenuLoader(!1);e.addContribution("widgetActions",t,80)})),function(){var e=dojo.declare("com.ibm.portal.PortalOperation",[com.ibm.mashups.enabler.ac.operation.Operation],{allowed:!1,constructor:function(e,o){this.allowed=e,o&&o(this)},isAllowed:function(e){return this.allowed}}),o=com.ibm.mashups.enabler;o.ac.operation.AllowedOperationsModelFactory.getAllowedOperationsModel().setOperation(com.ibm.pb.extension.Operations.PAGE_ACTIONS,(function(t,i,a,n){var r=o.model.Factory.getUserModel().getAnonymousMode()!=o.user.AnonymousMode.ANONYMOUS;if(!r){var s=ibmPortalCPConfig,m=i&&i.contentNode;r=null!=s&&s.isTaggingEnabled&&s.contextMenu.isTaggingEnabled&&s.operations.canViewTags&&(!m||!m.getMetaData||"true"!==m.getMetaData("com.ibm.portal.cp.tagging.isTaggingDisabled"))||null!=s&&s.isRatingEnabled&&s.contextMenu.isRatingEnabled&&s.operations.canViewRatings&&(!m||!m.getMetaData||"true"!==m.getMetaData("com.ibm.portal.cp.rating.isRatingDisabled"))}new e(r,n)}))}();