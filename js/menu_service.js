var CONST_USERAGT=navigator.userAgent.toLowerCase(),CONST_IS_MAJOR=parseInt(navigator.appVersion),CONST_IS_MINOR=parseFloat(navigator.appVersion),CONST_IS_IE=-1!=CONST_USERAGT.indexOf("msie")&&-1==CONST_USERAGT.indexOf("opera"),CONST_IS_GECKO=-1!=CONST_USERAGT.indexOf("gecko"),CONST_IS_NAV=-1!=CONST_USERAGT.indexOf("mozilla")&&-1==CONST_USERAGT.indexOf("spoofer")&&-1==CONST_USERAGT.indexOf("compatible")&&-1==CONST_USERAGT.indexOf("opera")&&-1==CONST_USERAGT.indexOf("webtv")&&-1==CONST_USERAGT.indexOf("hotjava"),CONST_IS_NAV4=CONST_IS_NAV&&4==CONST_IS_MAJOR,CONST_IS_OPERA=-1!=CONST_USERAGT.indexOf("opera"),scrollbackx=0,scrollbacky=0,menuSvcInst;function MenuService(){this.menuDefinitions=new Array}function menuService_scrollback(){CONST_IS_GECKO&&window.setTimeout("window.scrollTo(scrollbackx, scrollbacky)",35)}function menuService_showMenu(e,n,t,i,r){MenuService.currentClient=e;var o=menuService_getApplet();if(o){var u=o.getNewVector();if(null!=t)for(var a=0;a<t.length;a++)u.addElement(t[a]?"true":"false");CONST_IS_GECKO&&(scrollbackx=window.pageXOffset,scrollbacky=window.pageYOffset),o.showMenu(menuService_convertArrayToVector(n),u,"menuService_callback",i,r)}}function menuService_callback(e){MenuService.currentClient&&null!=MenuService.currentClient&&MenuService.currentClient.menuItemSelected(e)}function menuService_removeListener(){MenuService.currentClient=null}function menuService_parseMenuData(e,n){var t=e.toLowerCase(),i=this.menuDefinitions[t];return i||(CONST_IS_IE?(i=new ActiveXObject("microsoft.xmldom"),this.menuDefinitions[t]=i,i.async=!1):document.implementation&&(i=document.implementation.createDocument("","",null),n&&i.addEventListener("load",n,!1)),i&&i.load(e)),i}function menuService_convertArrayToVector(e){var n=menuService_getApplet();if(!n)return null;for(var t=n.getNewVector(),i=0;i<e.length;i++)t.addElement(e[i]);return t}function menuService_writeApplet(e){if(!window.menuServiceWroteApplet)if(menuService_getApplet())window.menuServiceWroteApplet=!0;else{var n="<applet code='com.lotus.cs.menu.MenuDisplayer' id='menuDisplayer' name='menuDisplayer'";n+="height='0' width='0' mayscript='true' archive='menudisp.jar' codebase='"+(e||"/wps/menu")+"'"+(CONST_IS_IE?"style='position:absolute;left:0;top:0;visibility:hidden'":"")+">",n+="<param name='useslibrary' value='LotusMenu'>",n+="<param name='useslibrarycodebase' value='menudisp.cab'>",n+="<param name='useslibraryversion' value='1,0,0,1'>",n+="<param name='namespace' value='LotusMenu'></applet>",CONST_IS_NAV4?document.writeln("<layer name='MenuDisplayerLayer'>"+n+"</layer>"):CONST_IS_IE?document.writeln("<span style='position:absolute;left:0;top:0;visibility:hidden'>"+n+"</span>"):CONST_IS_GECKO?document.writeln("<span style='position:fixed;left:0;top:0;visibility:hidden'>"+n+"</span>"):document.writeln(n),window.menuServiceWroteApplet=!0}}function menuService_getApplet(){var e=document.applets.menuDisplayer;if(e)return e;if(CONST_IS_NAV4){var n=document.layers.MenuDisplayerLayer;n&&(e=n.document.applets.menuDisplayer)}else document.getElementById&&(e=document.getElementById("menuDisplayer"));return e}function menuService_translateToAbsolute(e){var n=CONST_IS_IE?window.parent.screenLeft-window.screenLeft:0,t=CONST_IS_IE?window.parent.screenTop-window.screenTop:0;e.x-=n,e.y-=t}function WPSMenu(e){this.id=e,this.items=new Array,this.actions=new Array,this.enable=new Array}function WPSMenuContext(e){if(e)for(var n in e)this[n]=e[n];this.menuHandler=new Array}function WPSMenuHandler(e,n){this.menu=e,this.context=n}function wpsMenuContext_initialize(xmlpath,props){var mc=new WPSMenuContext(props),menusvc=getMenuService(),pmenus=menusvc.parseMenuData(xmlpath);if(null==pmenus)return mc;for(var menuNodes=pmenus.getElementsByTagName("menu"),n=0;n<menuNodes.length;n++){var mNode=menuNodes.item(n),idNode=mNode.attributes.getNamedItem("id");if(null!=idNode){for(var themenu=new WPSMenu(idNode.nodeValue),itemnodes=idNode.getElementsByTagName("menuitem"),i=0;i<itemnodes.length;i++){var menuitem=itemnodes.item(i),label=menuitem.attributes.getNamedItem("label").nodeValue,hideWhenNode=menuitem.attributes.getNamedItem("hidewhen");if(!hideWhenNode||!eval(hideWhenNode.nodeValue)){var actionNode=menuitem.attributes.getNamedItem("action");themenu.addMenuItem(label,actionNode)}}mc.addMenu(themenu,mc)}}return mc}function showPortalMenu(e,n,t){t&&t.showMenu(e,n)}function kwFindAbsoluteTop(e){for(var n=0,t=e,i=window.document.body;t&&null!=t&&t!=i;)n+=t.offsetTop,t=t.offsetParent;return n}function kwFindAbsoluteLeft(e){for(var n=0,t=e,i=window.document.body;t&&null!=t&&t!=i;)n+=t.offsetLeft,t=t.offsetParent;return n}function getMenuService(){return menuSvcInst||(window.ServiceRegistry&&(menuSvcInst=window.ServiceRegistry.getService("MenuService")),menuSvcInst||(menuSvcInst=new MenuService),menuSvcInst)}MenuService.prototype.showMenu=menuService_showMenu,MenuService.prototype.parseMenuData=menuService_parseMenuData,MenuService.prototype.removeListener=menuService_removeListener,WPSMenu.prototype.addMenuItem=function(e,n,t){this.items[this.items.length]=e,this.actions[this.actions.length]=n,this.enable[this.enable.length]=t||null},WPSMenu.prototype.addMenuSeparator=function(){this.addMenuItem("-")},WPSMenuContext.prototype.addMenu=function(e,n){var t=n||new WPSMenuHandler(e,this);this.setHandler(e.id,t)},WPSMenuContext.prototype.showMenu=function(e,n){var t=10,i=10;void 0===n&&(n=window.event),void 0!==n&&(t=n.clientX?n.clientX:n.pageX,i=n.clientY?n.clientY:n.pageY),this.showMenuAt(e,t,i)},WPSMenuContext.prototype.showMenuAt=function(e,n,t){if(e){var i=this.menuHandler[e];i&&menuService_showMenu(i,i.getLabels(),i.getEnableArray(),n,t)}},WPSMenuContext.prototype.setHandler=function(e,n){this.menuHandler[e]=n},WPSMenuHandler.prototype.getLabels=function(){return this.menu.items},WPSMenuHandler.prototype.getEnableArray=function(){for(var menuEnable=new Array,i=0;i<this.menu.enable.length;i++)menuEnable[i]=!this.menu.enable[i]||eval(this.menu.enable[i]);return menuEnable},WPSMenuHandler.prototype.menuItemSelected=function(ix){if(this.menu.actions[ix]){var act=this.menu.actions[ix];this.context&&this.context[act]?CONST_IS_IE?this.context[act]():eval("this.context."+act+"()"):eval(act)}},window.ServiceRegistry&&ServiceRegistry.registerService("MenuService","MenuService");